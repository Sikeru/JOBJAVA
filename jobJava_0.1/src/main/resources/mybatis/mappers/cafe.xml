<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.1//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 꿈터게시판 -->
<mapper namespace="com.jobjava.JJ.cafe.dao.CafeDAO">

	<select id="selcetProgram" resultType="ProgramVO">
   <![CDATA[
      SELECT PROGRAM_NO, TITLE,
      S_DATE, E_DATE FROM PROGRAM
      ]]>
	</select>

	<!-- <select id="selectProgramDetail" resultType="ProgramVO" parameterType="String"> 
		<![CDATA[ SELECT * FROM PROGRAM WHERE PROGRAM_NO = #{PROGRAMNO} ]]> </select> -->



	<!-- 기업등록조회 + 페이징 + 검색 -->
	<sql id="search">
		<if test="searchType != null">
			<if test="searchType == 'T'.toString()">AND TITLE LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'C'.toString()">AND CONTENT LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'TC'.toString()">AND (TITLE LIKE '%' || #{keyword} || '%') or (CONTENT
				LIKE '%' || #{keyword} || '%')</if>
		</if>
	</sql>
	<select id="boardList" resultType="hashmap"
		parameterType="hashmap">
        <![CDATA[
            SELECT PROGRAM_NO, 
                TITLE, 
                CONTENT,
                S_DATE, 
                E_DATE
                
         FROM ( 
                SELECT PROGRAM_NO,
                       B_NO,
                       TITLE, 
                       CONTENT, 
                       FILENAME, 
                       S_DATE,
                       E_DATE, 
                       ROW_NUMBER() OVER(ORDER BY PROGRAM_NO) AS RNUM
                 FROM PROGRAM
                 WHERE 1=1]]>

		<include refid="search"></include>

<![CDATA[
		)
		WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
		ORDER BY PROGRAM_NO ASC
		]]>

	</select>


	<select id="boardListCnt" parameterType="SearchCriteria"
		resultType="int">

   <![CDATA[
      SELECT count(*)
      FROM PROGRAM
       WHERE 1=1
      ]]>
		<include refid="search"></include>
	</select>



	<!-- 채용정보 상세조회 -->
	<select id="selectProgram" parameterType="String"
		resultType="ProgramVO">
   <![CDATA[
      SELECT * FROM PROGRAM
      WHERE PROGRAM_NO = #{PROGRAM_NO}  
   ]]>
	</select>



	<!--프로그램 파일표시 -->
	<select id="selectProgramFile" resultType="java.util.Map">
   <![CDATA[
   SELECT EMP_FILENAME FROM PROGRAM_FILE
       WHERE PROGRAM_NO = #{param1}
   ]]>
	</select>

	<!-- 파일 번호가져오기 -->
	<select id="selectFileNO" resultType="String">
	<![CDATA[
		 SELECT EMP_FILE FROM PROGRAM_FILE
		 WHERE PROGRAM_NO = #{param1}
		
	]]>
	</select>





	<!-- 글 수정 -->
	<update id="proupdate" parameterType="java.util.Map">
	<![CDATA[	UPDATE PROGRAM
		SET TITLE =
		#{TITLE, jdbcType=VARCHAR},
		CONTENT =
		#{CONTENT, jdbcType=VARCHAR}
		WHERE
		PROGRAM_NO = #{PROGRAM_NO}
		]]>
	</update>


	<!-- 글 삭제 -->
	<delete id="prodelete" parameterType="int">
		DELETE
		FROM PROGRAM
		WHERE
		PROGRAM_NO = #{PROGRAM_NO}
	</delete>
    
    
    	<!-- 파일 개당 삭제 -->
	<delete id="updatefile" >
		DELETE
		FROM PROGRAM_FILE
		WHERE
		PROGRAM_NO = #{param1} AND EMP_FILENAME =#{param2}
	</delete>

	<!-- 수정시 파일 추가 -->
	<insert id="updatefile2" parameterType="java.util.Map">
		<foreach item="item" collection="list" open="INSERT ALL"
			separator=" " close="SELECT * FROM DUAL">
			INTO PROGRAM_FILE(EMP_FILE, PROGRAM_NO,
			EMP_FILENAME, EMP_DATE)
			VALUES(#{item.EMP_FILE}, #{item.PROGRAM_NO},
			#{item.EMP_FILENAME}, SYSDATE)
		</foreach>
	</insert>

    
    <!-- 기업 마이페이지 리스트 -->
	<select id="companymypagelist" resultType="ProgramVO"> 
    <![CDATA[
 	SELECT 
    PP.PROGRAM_NO,
    EMP_PAR_NO, 
    TITLE, 
    DIVISION, 
    APP, 
    PP.ID,
    CM.ID,    
    QUESTION
	FROM 
    PRO_PART PP, 
    PROGRAM PR, 
    C_MEMBER CM
    WHERE 
    PP.PROGRAM_NO = PR.PROGRAM_NO 
	AND 
    CM.ID = #{user_id}
     ]]>
	</select>

	
	<!-- 기업 마이페이지 신청서 상세뷰 -->
	<select id="selectpro" resultType="ProgramVO" parameterType="int"> 
    
    <![CDATA[
 	  SELECT PP.PROGRAM_NO, EMP_PAR_NO, TITLE, DIVISION, ID, QUESTION, APP
      FROM PROGRAM PR, PRO_PART PP
      WHERE PR.PROGRAM_NO = PP.PROGRAM_NO AND PR.PROGRAM_NO = #{PROGRAM_NO}
      ]]>
      
	</select>
	
	<!-- 기업 마이페이지 신청서 상태수정 -->
	<update id="companymypageupdate" parameterType="String">
      UPDATE
          PRO_PART
      SET
          APP = #{param1}
      WHERE 
          EMP_PAR_NO = #{param2}
   </update>


	<!-- 학생 마이페이지 리스트 -->
	<select id="studentmypagelist" resultType="ProgramVO"> 
    <![CDATA[
 	SELECT PP.PROGRAM_NO, EMP_PAR_NO, TITLE, DIVISION , APP, ID
    	 FROM PROGRAM PR, PRO_PART PP
    	 WHERE PR.PROGRAM_NO = PP.PROGRAM_NO AND ID = #{user_id}
 	     
      ]]>
	</select>


	<!-- 꿈터구직등록 -->


	<insert id="JobinsertNewArticle" parameterType="java.util.Map">
	<![CDATA[
		INSERT INTO JOB_APPLICATION(JOB_APP_NO, ID, FILENAME, AREA, OCC_TYPE, E_DATE, F_FAMILY, DISCLOSURE, DISABILITY, MILITARY) 
					VALUES(#{JOB_APP_NO} ,#{ID}, NULL, #{AREA}, #{OCC_TYPE}, #{E_DATE}, #{F_FAMILY}, #{DISCLOSURE}, #{DISABILITY}, #{MILITARY})
	]]>
	</insert>

	<select id="selectMemberID" resultType="String"
		parameterType="java.util.HashMap">
	<![CDATA[ 
	SELECT ID FROM MEMBER WHERE ID = #{ID}
	]]>
	</select>
	
	
		<!-- 구직등록 파일번호 가져오기 -->
	<select id="JobselectNewImageFileNO" resultType="int">
		<![CDATA[
			SELECT nvl(max(JA_FILENO), 0) from JA_FILE
			]]>
	</select>

	<!-- 구직등록 번호 가져오기 -->
	<select id="selectJOB_APP_NO" resultType="int">
	<![CDATA[
		 SELECT nvl(max(JOB_APP_NO),0) +1 from JOB_APPLICATION
	]]>
	</select>
	
	
	
	
	<!-- 구직등록 파일추가 -->
	<insert id="JobinsertNewImage" parameterType="java.util.Map">
		<foreach item="item" collection="list" open="INSERT ALL"
			separator=" " close="SELECT * FROM DUAL">
			INTO JA_FILE(JA_FILENO, JOB_APP_NO,
			JA_DATE,
			JA_FILENAME)
			VALUES(#{item.JA_FILENO}, #{item.JOB_APP_NO},
			SYSDATE, #{item.JA_FILENAME})
		</foreach>
	</insert>




	<!-- 신청서 -->


	<insert id="apply" parameterType="ApplyVO">
	<![CDATA[
		INSERT INTO PRO_PART(EMP_PAR_NO, PROGRAM_NO, ID, QUESTION, APP) 
					VALUES(EMP_PAR_NO.NEXTVAL,#{PROGRAM_NO}, #{ID}, #{QUESTION}, '미승인')
	]]>
	</insert>

	<select id="selectMemberID2" resultType="String"
		parameterType="java.util.HashMap">
	<![CDATA[ 
	SELECT ID FROM MEMBER WHERE ID=#{ID}
	]]>
	</select>

	<!--다중 이미지 추가 SQL문 --><!-- 꿈터기업마이페이지 -->
	<insert id="insertNewArticle" parameterType="java.util.Map">
	  <![CDATA[
     INSERT INTO PROGRAM(PROGRAM_NO, B_NO, TITLE, CONTENT, S_DATE, E_DATE, FILENAME, DIVISION) 
					VALUES(#{PROGRAM_NO}, #{B_NO}, #{TITLE}, #{CONTENT}, #{S_DATE}, #{E_DATE}, NULL , #{DIVISION})
    ]]>
	</insert>

	<!-- 프로그램파일추가 -->
	<insert id="insertNewImage" parameterType="java.util.Map">
		<foreach item="item" collection="list" open="INSERT ALL"
			separator=" " close="SELECT * FROM DUAL">
			INTO PROGRAM_FILE(EMP_FILE, PROGRAM_NO,
			EMP_FILENAME,
			EMP_DATE)
			VALUES(#{item.EMP_FILE}, #{item.PROGRAM_NO},
			#{item.EMP_FILENAME}, SYSDATE)
		</foreach>
	</insert>

	<!-- 프로그램 파일번호 가져오기 -->
	<select id="selectNewImageFileNO" resultType="int">
		<![CDATA[
			SELECT nvl(max(EMP_FILE), 0) from PROGRAM_FILE]]>
	</select>

	<!-- 프로그램 번호 가져오기 -->
	<select id="selectPROGRAM_NO" resultType="int">
	<![CDATA[
		 SELECT nvl(max(PROGRAM_NO),0) +1 from PROGRAM
	]]>
	</select>

	<!-- ID에 따른 사업자번호 가져오기 -->
	<select id="selectCompanyID" resultType="String"
		parameterType="java.util.HashMap">
	<![CDATA[
		SELECT B_NO FROM C_MEMBER
		WHERE ID= #{ID}
	]]>
	</select>



	<!-- 여기부터 -->
	<!-- 프로그램 게시판 수정 파일만 추가 -->
	<insert id="insertModNewImage" parameterType="java.util.Map">
		<foreach item="item" collection="list" open="INSERT ALL"
			separator=" " close="SELECT * FROM DUAL">
			INTO noti_file(up_fileNO, up_fileName, noti_NO,
			up_date)
			VALUES (#{item.up_fileNO},
			#{item.up_fileName},
			#{item.noti_NO},
			SYSDATE)
		</foreach>
	</insert>

	<!-- 프로그램 게시판 다중 파일 수정하기 -->
	<update id="updateArticle" parameterType="java.util.Map">
		update board_Notice
		set
		noti_title=#{noti_title},
		noti_context=#{noti_context}
		where
		noti_NO=#{noti_NO}
	</update>

	<!-- 프로그램 게시판 파일 수정 -->
	<update id="updateImageFile" parameterType="java.util.List">
		<foreach collection="list" item="item" separator=";"
			open="DECLARE BEGIN" close="; END;">
			<choose>
				<when test="item.up_fileName != null ">
					update noti_file
					set up_fileName =
					#{item.up_fileName}
					where
					noti_NO=#{item.noti_NO}
					and up_fileNO =
					#{item.up_fileNO}
				</when>
				<otherwise>

				</otherwise>
			</choose>
		</foreach>
	</update>


	<!-- 여기까지 -->


	<!-- 꿈터 캘린더 -->

	<select id="selectSdata" resultType="String">
		<![CDATA[
			SELECT COMPANY FROM JOB_INFO WHERE S_DATE = TO_DATE(#{param1}) AND ROWNUM<=3
		]]>
	</select>

	<select id="selectDdata" resultType="String">
		<![CDATA[
			SELECT COMPANY FROM JOB_INFO WHERE D_DATE = TO_DATE(#{param1}) AND ROWNUM<=3
		]]>
	</select>

	<!-- 취업컨설팅 -->
	<select id="boardList2" resultType="hashmap"
		parameterType="hashmap">
        <![CDATA[
            SELECT * FROM (SELECT PROGRAM.PROGRAM_NO, EMP_FILENAME, TITLE, CONTENT, S_DATE, E_DATE, DIVISION
           FROM PROGRAM_FILE ,PROGRAM 
           WHERE EMP_FILE  = ANY(SELECT MIN(EMP_FILE) EMP_FILE FROM PROGRAM_FILE
           GROUP BY PROGRAM_NO) AND PROGRAM_FILE.program_no = PROGRAM.PROGRAM_NO
           ORDER BY PROGRAM.PROGRAM_NO DESC)
           WHERE DIVISION LIKE '취업컨설팅' AND ROWNUM <5 
           ]]>

	</select>

	<!-- 취업컨설팅2 -->
	<select id="boardListCnt2" parameterType="SearchCriteria"
		resultType="int">

   <![CDATA[
      SELECT count(*)
      FROM PROGRAM
       WHERE 1=1
      ]]>
		<include refid="search"></include>
	</select>
	
	
		<!-- 취업특강-->
	<select id="boardList3" resultType="hashmap"
		parameterType="hashmap">
        <![CDATA[
            SELECT * FROM (SELECT PROGRAM.PROGRAM_NO, EMP_FILENAME, TITLE, CONTENT, S_DATE, E_DATE, DIVISION
           FROM PROGRAM_FILE ,PROGRAM 
           WHERE EMP_FILE  = ANY(SELECT MIN(EMP_FILE) EMP_FILE FROM PROGRAM_FILE
           GROUP BY PROGRAM_NO) AND PROGRAM_FILE.program_no = PROGRAM.PROGRAM_NO
           ORDER BY PROGRAM.PROGRAM_NO DESC)
           WHERE DIVISION LIKE '취업특강' AND ROWNUM <5 
           ]]>

	</select>

	<!-- 취업특강2 -->
	<select id="boardListCnt3" parameterType="SearchCriteria"
		resultType="int">

   <![CDATA[
      SELECT count(*)
      FROM PROGRAM
       WHERE 1=1
      ]]>
		<include refid="search"></include>
	</select>



	<!-- 채용공고 게시판 -->
	<select id="selectJobPosting" resultType="JobInfoVO">
   <![CDATA[
      SELECT JOB_NO, COMPANY, TITLE, S_DATE, D_DATE, CAREER, AREA, EDU FROM JOB_INFO
      ]]>
	</select>


	<sql id="infosearch">
		<if test="searchType != null">
			<if test="searchType == 'T'.toString()">AND COMPANY LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'C'.toString()">AND CONTENT LIKE '%' || #{keyword} || '%'</if>
			<if test="searchType == 'TC'.toString()">AND (TITLE LIKE '%' || #{keyword} || '%') or (CONTENT
				LIKE '%' || #{keyword} || '%')</if>
		</if>
	</sql>

	<select id="postingList" resultType="hashmap"
		parameterType="hashmap">
        <![CDATA[
            SELECT JOB_NO, 
                COMPANY, 
                TITLE,
                CAREER,
                EDU,
                AREA,
                S_DATE,
                D_DATE
         FROM ( 
                SELECT JOB_NO,
                       CAREER,
                       EDU,
                       AREA, 
                       SAL, 
                       EMP_TYPE, 
                       WORK_TYPE,
                       WELFARE,
                       COMPANY,
                       B_TYPE,
                       SCALE,
                       ESTABLISH,
                       Y_SALES,
                       HP,
                       EMP_NUM,
                       S_DATE,
                       D_DATE,
                       JOB_D,
                       TITLE,
                     ROW_NUMBER() OVER(ORDER BY JOB_NO) AS RNUM
                 FROM JOB_INFO
            WHERE 1=1]]>
		<include refid="infosearch"></include>

<![CDATA[
      )
      WHERE RNUM BETWEEN #{rowStart} AND #{rowEnd}
      ORDER BY JOB_NO ASC
      ]]>

	</select>


	<select id="postingListCnt" parameterType="SearchCriteria"
		resultType="int">

   <![CDATA[
      SELECT count(*)
      FROM JOB_INFO
       WHERE 1=1
      ]]>
		<include refid="infosearch"></include>
	</select>

	<!-- 채용공고 상세조회 -->
	<select id="jobpostingdetail" parameterType="int"
		resultType="JobInfoVO">
   <![CDATA[
	   SELECT 
	   JOB_NO,
	   CAREER,
	   EDU,
	   AREA,
	   SAL,
	   EMP_TYPE,
	   WORK_TYPE,
	   WELFARE,
	   COMPANY,
	   B_TYPE,
	   SCALE,
	   ESTABLISH,
	   Y_SALES,
	   HP,
	   EMP_NUM,
	   S_DATE,
	   D_DATE,
	   JOB_D,
	   TITLE
	   FROM 
	   JOB_INFO
	   
	   WHERE 
	   JOB_NO = #{JOB_NO}  
   ]]>
	</select>

	<!-- 채용공고 글 수정 -->
	<update id="jobpostingupdate" parameterType="JobInfoVO">
		UPDATE JOB_INFO
		SET
		TITLE =
		#{TITLE, jdbcType=VARCHAR},
		JOB_D =
		#{JOB_D,
		jdbcType=VARCHAR},
		CAREER =
		#{CAREER, jdbcType=VARCHAR},
		EDU =
		#{EDU ,
		jdbcType=VARCHAR},
		AREA =
		#{AREA , jdbcType=VARCHAR},
		SAL =
		#{SAL ,
		jdbcType=VARCHAR},
		EMP_TYPE =
		#{EMP_TYPE , jdbcType=VARCHAR},
		WORK_TYPE =
		#{WORK_TYPE ,
		jdbcType=VARCHAR},
		WELFARE =
		#{WELFARE ,
		jdbcType=VARCHAR},
		COMPANY =
		#{COMPANY , jdbcType=VARCHAR},
		B_TYPE =
		#{B_TYPE , jdbcType=VARCHAR},
		SCALE =
		#{SCALE , jdbcType=VARCHAR},
		ESTABLISH =
		#{ESTABLISH ,
		jdbcType=DATE},
		Y_SALES =
		#{Y_SALES ,
		jdbcType=VARCHAR},
		HP =
		#{HP ,
		jdbcType=VARCHAR},
		EMP_NUM =
		#{EMP_NUM ,
		jdbcType=VARCHAR},
		s_DATE =
		#{s_DATE , jdbcType=DATE},
		d_DATE =
		#{d_DATE , jdbcType=DATE}
		WHERE
		JOB_NO = #{JOB_NO}
	</update>

	<!-- 채용공고 글 삭제 -->
	<delete id="jobPostingDelete" parameterType="int">
		DELETE
		FROM JOB_INFO
		WHERE
		JOB_NO = #{JOB_NO}
	</delete>

	<!-- 장바구니 조회 -->
	<select id="selectJobPostingInCart" resultType="ShopBasketVO"
		parameterType="String">
	<![CDATA[
	SELECT * FROM JOB_INFO J, SHOP_BASKET S
   WHERE J.JOB_NO = S.JOB_NO AND S.EMP_NO = (SELECT EMP_NO FROM EMP WHERE ID = #{ID})
	]]>
	</select>


	<!-- 장바구니 담기 -->
	<select id="jobPostingInsertInCart" parameterType="ShopBasketVO">
		<![CDATA[
		INSERT INTO SHOP_BASKET VALUES(SHOP_NO.NEXTVAL, #{JOB_NO}, (SELECT
		EMP_NO FROM EMP WHERE ID = #{ID}))	
		]]>
	</select>

	<!-- 장바구니 리스트 조회 -->
	<select id="jobPostingInCartList" resultType="ShopBasketVO">
    <![CDATA[
    	SELECT JOB_NO
		FROM SHOP_BASKET
    ]]>
	</select>


	<!-- 장바구니 리스트 조회 -->
	<select id="bascketList" resultType="int">
   <![CDATA[
      SELECT JOB_NO FROM SHOP_BASKET
      ]]>
	</select>

	<!-- 장바구니 조회 -->
	<select id="empnoid" resultType="int">
   <![CDATA[
      SELECT EMP_NO 
      FROM EMP 
      WHERE ID = #{param1}
      ]]>
	</select>

	<!-- 장바구니 삭제 -->
	<delete id="jobPostingInCartDelete" parameterType="int">
		DELETE
		FROM
		SHOP_BASKET
		WHERE
		JOB_NO = #{param1}
	</delete>







</mapper>
